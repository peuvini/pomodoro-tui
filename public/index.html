<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pomodoro Timer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.5s ease;
    }

    body.work {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
    }

    body.shortBreak {
      background: linear-gradient(135deg, #27ae60, #1e8449);
    }

    body.longBreak {
      background: linear-gradient(135deg, #3498db, #2980b9);
    }

    .container {
      text-align: center;
      color: white;
    }

    .session-label {
      font-size: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      margin-bottom: 0.5rem;
      opacity: 0.9;
    }

    .session-name {
      font-size: 1rem;
      margin-bottom: 1rem;
      opacity: 0.8;
    }

    .session-name-input {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border: 1px solid rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border-radius: 25px;
      outline: none;
      width: 200px;
      text-align: center;
    }

    .session-name-input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }

    .session-name-input:focus {
      border-color: rgba(255, 255, 255, 0.8);
      background: rgba(255, 255, 255, 0.15);
    }

    .timer {
      font-size: 8rem;
      font-weight: 200;
      letter-spacing: 0.05em;
      margin: 2rem 0;
      font-variant-numeric: tabular-nums;
    }

    .controls {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 2rem;
    }

    .btn {
      padding: 1rem 2rem;
      font-size: 1rem;
      border: 2px solid rgba(255, 255, 255, 0.8);
      background: transparent;
      color: white;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn.primary {
      background: rgba(255, 255, 255, 0.2);
      min-width: 140px;
    }

    .stats {
      font-size: 1rem;
      opacity: 0.8;
    }

    .pomodoro-dots {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
    }

    .dot.completed {
      background: rgba(255, 255, 255, 0.9);
    }

    @media (max-width: 600px) {
      .timer {
        font-size: 5rem;
      }

      .controls {
        flex-wrap: wrap;
      }

      .btn {
        padding: 0.75rem 1.5rem;
      }
    }
  </style>
</head>
<body class="work">
  <div class="container">
    <div class="session-label" id="sessionLabel">Work</div>
    <div class="session-name" id="sessionName">
      <input type="text" class="session-name-input" id="sessionNameInput" placeholder="Name this session..." maxlength="50">
    </div>
    <div class="timer" id="timer">25:00</div>
    <div class="controls">
      <button class="btn primary" id="startPauseBtn">Start</button>
      <button class="btn" id="resetBtn">Reset</button>
      <button class="btn" id="skipBtn">Skip</button>
    </div>
    <div class="stats">
      <span id="completedCount">0</span> pomodoros completed
      <div class="pomodoro-dots" id="pomodoroDots"></div>
    </div>
  </div>

  <script>
    const DEFAULT_CONFIG = {
      workDuration: 25,
      shortBreakDuration: 5,
      longBreakDuration: 15,
      pomodorosBeforeLongBreak: 4,
    };

    class Pomodoro {
      constructor(config = {}) {
        this.config = { ...DEFAULT_CONFIG, ...config };
        this.state = {
          currentSession: 'work',
          timeRemaining: this.config.workDuration * 60,
          isRunning: false,
          completedPomodoros: 0,
          sessionName: null,
        };
        this.timer = null;
        this.onTick = null;
        this.onSessionComplete = null;
      }

      setSessionName(name) {
        this.state.sessionName = name || null;
        this.onTick?.(this.getState());
      }

      getSessionName() {
        return this.state.sessionName;
      }

      setOnTick(callback) {
        this.onTick = callback;
      }

      setOnSessionComplete(callback) {
        this.onSessionComplete = callback;
      }

      getState() {
        return { ...this.state };
      }

      start() {
        if (this.state.isRunning) return;
        this.state.isRunning = true;
        this.timer = setInterval(() => this.tick(), 1000);
        this.onTick?.(this.getState());
      }

      pause() {
        if (!this.state.isRunning) return;
        this.state.isRunning = false;
        if (this.timer) {
          clearInterval(this.timer);
          this.timer = null;
        }
        this.onTick?.(this.getState());
      }

      reset() {
        this.pause();
        this.state.timeRemaining = this.getSessionDuration(this.state.currentSession) * 60;
        this.onTick?.(this.getState());
      }

      skip() {
        this.pause();
        this.completeSession();
      }

      tick() {
        this.state.timeRemaining--;
        if (this.state.timeRemaining <= 0) {
          this.completeSession();
        }
        this.onTick?.(this.getState());
      }

      completeSession() {
        const completedSession = this.state.currentSession;
        this.onSessionComplete?.(completedSession);

        if (completedSession === 'work') {
          this.state.completedPomodoros++;
          if (this.state.completedPomodoros % this.config.pomodorosBeforeLongBreak === 0) {
            this.state.currentSession = 'longBreak';
          } else {
            this.state.currentSession = 'shortBreak';
          }
        } else {
          this.state.currentSession = 'work';
          this.state.sessionName = null; // Clear name for new work session
        }

        this.state.timeRemaining = this.getSessionDuration(this.state.currentSession) * 60;
        this.state.isRunning = false;

        if (this.timer) {
          clearInterval(this.timer);
          this.timer = null;
        }

        this.onTick?.(this.getState());
      }

      getSessionDuration(session) {
        switch (session) {
          case 'work': return this.config.workDuration;
          case 'shortBreak': return this.config.shortBreakDuration;
          case 'longBreak': return this.config.longBreakDuration;
        }
      }

      formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
      }

      getSessionLabel(session) {
        switch (session) {
          case 'work': return this.state.sessionName ? `Work: ${this.state.sessionName}` : 'Work';
          case 'shortBreak': return 'Short Break';
          case 'longBreak': return 'Long Break';
        }
      }
    }

    // App initialization
    const pomodoro = new Pomodoro();

    const timerEl = document.getElementById('timer');
    const sessionLabelEl = document.getElementById('sessionLabel');
    const sessionNameEl = document.getElementById('sessionName');
    const sessionNameInput = document.getElementById('sessionNameInput');
    const startPauseBtn = document.getElementById('startPauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const skipBtn = document.getElementById('skipBtn');
    const completedCountEl = document.getElementById('completedCount');
    const pomodoroDotsEl = document.getElementById('pomodoroDots');

    function updateUI(state) {
      timerEl.textContent = pomodoro.formatTime(state.timeRemaining);
      sessionLabelEl.textContent = pomodoro.getSessionLabel(state.currentSession);
      startPauseBtn.textContent = state.isRunning ? 'Pause' : 'Start';
      completedCountEl.textContent = state.completedPomodoros;

      document.body.className = state.currentSession;
      document.title = `${pomodoro.formatTime(state.timeRemaining)} - ${pomodoro.getSessionLabel(state.currentSession)}`;

      // Show/hide session name input based on session type
      if (state.currentSession === 'work') {
        sessionNameEl.style.display = 'block';
        // Sync input with state (only if different to avoid losing cursor position)
        if (sessionNameInput.value !== (state.sessionName || '')) {
          sessionNameInput.value = state.sessionName || '';
        }
      } else {
        sessionNameEl.style.display = 'none';
      }

      // Update dots
      const dotsCount = pomodoro.config.pomodorosBeforeLongBreak;
      const completedInCycle = state.completedPomodoros % dotsCount;
      pomodoroDotsEl.innerHTML = '';
      for (let i = 0; i < dotsCount; i++) {
        const dot = document.createElement('div');
        dot.className = 'dot' + (i < completedInCycle ? ' completed' : '');
        pomodoroDotsEl.appendChild(dot);
      }
    }

    function onSessionComplete(session) {
      const label = pomodoro.getSessionLabel(session);
      if (Notification.permission === 'granted') {
        new Notification(`${label} Complete!`, {
          body: session === 'work' ? 'Time for a break!' : 'Ready to focus?',
        });
      }
    }

    pomodoro.setOnTick(updateUI);
    pomodoro.setOnSessionComplete(onSessionComplete);

    startPauseBtn.addEventListener('click', () => {
      const state = pomodoro.getState();
      if (state.isRunning) {
        pomodoro.pause();
      } else {
        pomodoro.start();
      }
    });

    resetBtn.addEventListener('click', () => pomodoro.reset());
    skipBtn.addEventListener('click', () => pomodoro.skip());

    // Update session name on input change
    sessionNameInput.addEventListener('input', (e) => {
      pomodoro.setSessionName(e.target.value);
    });

    // Request notification permission
    if ('Notification' in window && Notification.permission === 'default') {
      Notification.requestPermission();
    }

    // Initial render
    updateUI(pomodoro.getState());
  </script>
</body>
</html>
